<div class="create-patient-container">
  <p-card header="Création d'un nouveau patient" styleClass="create-patient-card">
    <form [formGroup]="patientForm" (ngSubmit)="onSubmit()" class="create-patient-form">
      <div class="form-section">
        <h2>Informations du patient</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="nom">Nom patient *</label>
            <input pInputText id="nom" formControlName="nom" class="form-control" />
            @if (patientForm.get('nom')?.invalid && patientForm.get('nom')?.touched) {
              <div class="error-message">Le nom est requis</div>
            }
          </div>

          <div class="form-group">
            <label for="prenom">Prénom patient *</label>
            <input pInputText id="prenom" formControlName="prenom" class="form-control" />
            @if (patientForm.get('prenom')?.invalid && patientForm.get('prenom')?.touched) {
              <div class="error-message">Le prénom est requis</div>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="email">Email *</label>
            <input pInputText type="email" id="email" formControlName="login" class="form-control" />
            @if (patientForm.get('login')?.invalid && patientForm.get('login')?.touched) {
              <div class="error-message">L'email est invalide</div>
            }
          </div>

          <div class="form-group">
            <label for="password">Password *</label>
            <input pInputText type="password" id="password" formControlName="password" class="form-control" />
            @if (patientForm.get('password')?.invalid && patientForm.get('password')?.touched) {
              <div class="error-message">Le password est invalide</div>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="adresse">Adresse</label>
            <input pInputText id="adresse" formControlName="adresse" class="form-control" />
          </div>

          <div class="form-group">
            <label for="telephone">Téléphone *</label>
            <input pInputText type="tel" id="telephone" formControlName="telephone" class="form-control" />
            @if (patientForm.get('telephone')?.invalid && patientForm.get('telephone')?.touched) {
              <div class="error-message">Le téléphone est requis</div>
            }
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Photo de profil</label>
          <div class="photo-preview">
            <img [src]="'data:image/png;base64,' + patientForm.get('photo')?.value"  alt="Photo de profil" *ngIf="patientForm.get('photo')?.value" style="max-width: 150px; max-height: 150px; margin-bottom: 1rem;">
          </div>
          <input type="file" accept="image/*" (change)="onPhotoSelected($event)"
                 class="form-control">
        </div>
      </div>

      <div class="form-section">
        <h2>Informations du parent</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="nomParent">Nom du parent *</label>
            <input pInputText id="nomParent" formControlName="nomParent" class="form-control" />
            @if (patientForm.get('nomParent')?.invalid && patientForm.get('nomParent')?.touched) {
              <div class="error-message">Le nom du parent est requis</div>
            }
          </div>

          <div class="form-group">
            <label for="prenomParent">Prénom du parent *</label>
            <input pInputText id="prenomParent" formControlName="prenomParent" class="form-control" />
            @if (patientForm.get('prenomParent')?.invalid && patientForm.get('prenomParent')?.touched) {
              <div class="error-message">Le prénom du parent est requis</div>
            }
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button pButton type="button" label="Annuler" class="p-button-secondary" (click)="cancel()"></button>
        <button pButton type="submit" label="Créer le patient" [disabled]="!patientForm.valid || loading"
                [loading]="loading" class="p-button-primary"></button>
      </div>
    </form>
  </p-card>
</div>
<p-toast></p-toast>
